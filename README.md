# 前言
https://github.com/Saqoosha/IMDAvoider/blob/main/imd.py から派生したものです。
日本のアマチュア無線のバンドプランの変更によりVTX電波の4波同時運用の可能性を探るものです。オリジナルのIMDツール http://etserv.etheli.com/IMDTabler/run は二つの周波数の合成による影響を計算するものでした。各所での実験の結果(主には屋内で飛行する環境で)、それだけでは見つけられない不具合があることがほぼ確実です。
そこで3波を合成した時に発生する周波数成分を考慮するように書き直してみました。

# IMD (Intermodulation Distortion) 計算ツール

このプロジェクトは、複数の周波数における相互変調歪み（IMD）を計算し、最適な周波数組み合わせを見つけるためのツールです。

## 概要

VTX（Video Transmitter）システムにおいて、複数の周波数を同時に使用する際に発生する相互変調歪みを評価し、干渉を最小化する周波数組み合わせを特定します。

## ファイル構成

- `imd.py` - メインのIMD計算モジュール
- `calculate_4freq_ratings.py` - 4周波数組み合わせの評価スクリプト
- `vtxtable.txt` - 周波数とチャネルの対応表
- `LED.txt` - 周波数レンジとLED番号の対応表
- `freq.txt` - 評価対象周波数リスト
- `result.txt` - 計算結果出力ファイル

## 機能

### 1. IMD計算 (`imd.py`)

#### 基本機能
- 二次合成（2*f1 - f2）の計算
- 三次合成（10パターン）の計算
- 周波数間の干渉評価
- チャネル名付き周波数表示

#### 三次合成パターン
1. f1 - f2 + f3
2. f1 + f2 - f3
3. 2*f1 - f2 - f3
4. f1 + f2 + f3
5. -f1 + f2 + f3
6. 2*f1 + f2 - f3
7. 2*f1 - f2 + f3
8. f1 - 2*f2 + f3
9. f1 + 2*f2 - f3
10. -f1 + 2*f2 + f3

#### 使用方法

# 全ての可能なチャネルの組み合わせ4845通りを評価
python3 calculate_4freq_ratings.py

# 特定の周波数で評価
python3 imd.py 5685 5705 5769 5809

# デバッグモードで評価
python3 imd.py --debug 5685 5705 5769 5809
```

#### 出力例
```
評価対象周波数: ['(E2)5685', '(E1)5705', '(R4)5769', '(B5)5809']
最終評価: -376
```

### 2. 4周波数組み合わせ評価 (`calculate_4freq_ratings.py`)

#### 機能
- `freq.txt`から周波数を読み込み
- 全ての4周波数組み合わせを評価
- LED番号付きで結果を表示
- 評価値でソートして表示

#### 使用方法
```bash
python3 calculate_4freq_ratings.py
```

#### 出力例
```
  1. 周波数: [5685(LED3), 5705(LED3), 5769(LED4), 5809(LED4)] -> 評価値: -245
  2. 周波数: [5685(LED3), 5705(LED3), 5769(LED4), 5815(LED4)] -> 評価値: -267
  ...

最高評価値: -245
最適な4周波数組み合わせ: [5685(LED3), 5705(LED3), 5769(LED4), 5809(LED4)]
```

## 設定ファイル

### vtxtable.txt
周波数とチャネル名の対応表
```
BOSCAM_A A FACTORY 5865 5845 5825 5805 5785 5765 5745 5725
BOSCAM_B B FACTORY 5733 5752 5771 5790 5809 5828 5847 5866
...
```

### LED.txt
周波数レンジとLED番号の対応表
```
5100-5199 LED1
5200-5299 LED2
5300-5399 LED3
...
```

### freq.txt
評価対象周波数のリスト
```
5685
5705
5725
...
```

## 評価システム

### 評価値の計算
- **基本値**: 100点
- **減点**: 各干渉パターンに対して計算
- **計算式**: `RATING_MAX_VALUE - total / 5 / n`
- **干渉判定**: 差が35MHz以下で評価対象

### 評価基準
- 評価値が高いほど良い組み合わせ
- 干渉が少ないほど高評価
- 周波数間の距離が適切なほど高評価

## デバッグ機能

`--debug`オプションを使用すると、以下の情報が表示されます：
- 二次合成の計算過程
- 三次合成の各パターンの計算過程
- 対象周波数と最近接周波数の比較
- 評価値の計算過程

## 技術仕様

- **対応周波数範囲**: 5100-6099 MHz
- **評価差限界**: 35 MHz
- **最大評価値**: 100点
- **対応チャネル**: A, B, E, F, Rバンド

## 注意事項

1. 必要なファイル（vtxtable.txt, LED.txt, freq.txt）が存在することを確認してください
2. 周波数は整数値で指定してください
3. デバッグモードは大量の出力を生成するため、必要時のみ使用してください

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。 
